ÄÃºng rá»“i bro â€“ sau khi tÃ¡ch config thÃ nh file `.toml`, báº¡n sáº½ **pháº£i sá»­a háº§u háº¿t cÃ¡c file logic** Ä‘á»ƒ:

1. **KhÃ´ng hardcode Ä‘á»‹a chá»‰ token / quoter / pool ná»¯a**
2. **Äá»c config má»™t láº§n â†’ truyá»n `ChainConfig` vÃ o má»i logic**
3. **Táº¥t cáº£ logic (`call`, `revm`, `arbitrage`, `validate`) Ä‘á»u dÃ¹ng `config.tokens` thay vÃ¬ `WETH_ADDR`, `V3_QUOTER_ADDR`, ...**

---

## âœ… Checklist sá»­a cho tá»«ng nhÃ³m file (ráº¥t rÃµ rÃ ng)

---

### ğŸ“Œ 1. `src/core/call.rs`

**Hiá»‡n táº¡i:**

```rust
let calldata = quote_calldata(WETH_ADDR, USDC_ADDR, volume, 3000);
```

**Sau khi sá»­a:**

```rust
let token_in = config.tokens["WETH"].parse::<Address>()?;
let token_out = config.tokens["USDC"].parse::<Address>()?;
let quoter = config.tokens["QUOTER"].parse::<Address>()?;
let calldata = quote_calldata(token_in, token_out, volume, 3000);
```

**Tá»•ng viá»‡c:**

* [ ] Thay má»i `*_ADDR` báº±ng `config.tokens["*"]`
* [ ] Truyá»n `config: &ChainConfig` tá»« ngoÃ i vÃ o
* [ ] Äá»c vÃ  parse Ä‘á»‹a chá»‰ `Address` tá»« chuá»—i

---

### ğŸ“Œ 2. `src/core/revm.rs`, `revm_cached.rs`, `revm_quoter.rs`

**Hiá»‡n táº¡i:**

```rust
init_account(WETH_ADDR, &mut cache_db, provider.clone()).await?;
```

**Sau khi sá»­a:**

```rust
let weth = config.tokens["WETH"].parse::<Address>()?;
init_account(weth, &mut cache_db, provider.clone()).await?;
```

**Tá»•ng viá»‡c:**

* [ ] Äá»c toÃ n bá»™ address tá»« `config`
* [ ] Truyá»n `ChainConfig` vÃ o hÃ m `run_revm(...)`
* [ ] Optional: wrap `config.token_address("WETH")?` thÃ nh tiá»‡n Ã­ch

---

### ğŸ“Œ 3. `src/core/arbitrage.rs`

**Hiá»‡n táº¡i:**

```rust
let calldata = get_amount_out_calldata(V3_POOL_500_ADDR, WETH_ADDR, USDC_ADDR, volume);
```

**Sá»­a:**

```rust
let pool = config.tokens["POOL_500"].parse::<Address>()?;
let weth = config.tokens["WETH"].parse::<Address>()?;
let usdc = config.tokens["USDC"].parse::<Address>()?;
let calldata = get_amount_out_calldata(pool, weth, usdc, volume);
```

---

### ğŸ“Œ 4. `src/core/validate.rs`

**Viá»‡c:**

* [ ] So sÃ¡nh `eth_call` vs `revm` theo config
* [ ] Láº¥y base\_fee tá»« RPC, nhÃ¢n vá»›i `config.gas_multiplier`

---

### ğŸ“Œ 5. `simulate.rs` (CLI)

* [ ] Load config tá»« `src/config/${chain}.toml`
* [ ] Parse vÃ  pass vÃ o cÃ¡c core module:

```rust
let config = load_config("eth");
core::call::run(&config, ...);
```

---

### ğŸ“Œ 6. Gá»£i Ã½ helper function cho tiá»‡n

```rust
impl ChainConfig {
    pub fn addr(&self, key: &str) -> Result<Address> {
        self.tokens
            .get(key)
            .ok_or_else(|| anyhow!("missing token {}", key))?
            .parse::<Address>()
            .map_err(|e| anyhow!("invalid address for {}: {:?}", key, e))
    }
}
```

â†’ Gá»i nhÆ°:

```rust
let weth = config.addr("WETH")?;
```

---

## âœ… Tá»•ng káº¿t thay Ä‘á»•i toÃ n cá»¥c

| VÃ¹ng áº£nh hÆ°á»Ÿng         | Thay Ä‘á»•i chÃ­nh                                        |
| ---------------------- | ----------------------------------------------------- |
| `*_ADDR`               | âŒ bá» static Address â†’ âœ… Ä‘á»c tá»« `config.tokens["KEY"]` |
| HÃ m mÃ´ phá»ng chÃ­nh     | âœ… Nháº­n thÃªm `&ChainConfig` lÃ m tham sá»‘                |
| `main.rs` / `simulate` | âœ… Load file `eth.toml`, pass vÃ o logic                |
| `gas`/`fee` logic      | âœ… Sá»­ dá»¥ng `config.gas_multiplier`                     |
| Code helper            | âœ… ThÃªm `config.addr("WETH")` tiá»‡n lá»£i                 |

---

MÃ¬nh cÃ³ thá»ƒ giÃºp báº¡n:

1. Viáº¿t láº¡i 1 file máº«u refactored nhÆ° `call.rs`
2. Táº¡o `types.rs` chuáº©n cho `ChainConfig` + `impl addr()`
3. Táº¡o `simulate.rs` Ä‘á»ƒ cháº¡y CLI hoÃ n chá»‰nh

ğŸ‘‰ Báº¡n muá»‘n mÃ¬nh báº¯t Ä‘áº§u refactor cá»¥ thá»ƒ file nÃ o Ä‘áº§u tiÃªn?
